<form [formGroup]="form" class="order-form">
  <!-- Cabeçalho -->
  <div class="order-grid header">
    <div>Código</div>
    <div>Descrição</div>
    <div>Quantidade</div>
    <div>Unitário</div>
    <div>Total</div>
    <div>Ações</div>
  </div>

  <!-- Itens -->
  <div formArrayName="items">
    <div
      *ngFor="let item of itemsFormArray.controls; let i = index"
      [formGroupName]="i"
      class="order-grid row"
      (keydown.enter)="onEnterKey(i, $event)"
    >
      <!-- Código -->
      <div class="cell">
        <input
          #rowInput
          formControlName="code"
          placeholder="Código"
          type="number"
          pattern="[0-9]*"
          (keydown)="blockInvalidKeys($event)"
          (input)="preventNegativeValue(itemsFormArray.at(i), $event)"
        />
        <div
          class="error"
          *ngIf="item.get('code')?.touched && item.get('code')?.errors"
        >
          <ng-container *ngIf="item.get('code')?.errors?.['required']">
            Código obrigatório.
          </ng-container>
          <ng-container *ngIf="item.get('code')?.errors?.['min']">
            O código não pode ser negativo.
          </ng-container>
        </div>
      </div>

      <!-- Descrição -->
      <div class="cell">
        <input formControlName="description" placeholder="Descrição" />
        <div
          class="error"
          *ngIf="item.get('description')?.touched && item.get('description')?.errors"
        >
          <ng-container *ngIf="item.get('description')?.errors?.['required']">
            Descrição obrigatória.
          </ng-container>
          <ng-container *ngIf="item.get('description')?.errors?.['maxlength']">
            A descrição deve ter no máximo 100 caracteres.
          </ng-container>
        </div>
      </div>

      <!-- Quantidade -->
      <div class="cell">
        <input
          formControlName="quantity"
          type="text"
          [appQuantityMask]="item.get('code')"
        />
        <div
          class="error"
          *ngIf="item.get('quantity')?.touched && item.get('quantity')?.errors"
        >
          <ng-container *ngIf="item.get('quantity')?.errors?.['required']">
            Quantidade obrigatória.
          </ng-container>
          <ng-container *ngIf="item.get('quantity')?.errors?.['min']">
            Quantidade deve ser maior que zero.
          </ng-container>
          <ng-container
            *ngIf="item.get('quantity')?.errors?.['invalidPrecision']"
          >
            Quantidade inválida: deve ser inteira para códigos pares ou até 3
            decimais para ímpares.
          </ng-container>
        </div>
      </div>

      <!-- Unitário -->
      <div class="cell">
        <input
          formControlName="unitPrice"
          type="text"
          currencyMask
          [options]="currencyOptions"
          (focus)="onFocusCurrency($event)"
        />
        <div
          class="error"
          *ngIf="item.get('unitPrice')?.touched && item.get('unitPrice')?.errors"
        >
          <ng-container *ngIf="item.get('unitPrice')?.errors?.['required']">
            Valor unitário obrigatório.
          </ng-container>
          <ng-container *ngIf="item.get('unitPrice')?.errors?.['min']">
            Valor unitário deve ser maior que zero.
          </ng-container>
        </div>
      </div>

      <!-- Total -->
      <div class="cell">
        <input
          formControlName="totalPrice"
          type="text"
          currencyMask
          [options]="currencyOptions"
          (focus)="onFocusCurrency($event)"
        />
        <div
          class="error"
          *ngIf="item.get('totalPrice')?.touched && item.get('totalPrice')?.errors"
        >
          <ng-container *ngIf="item.get('totalPrice')?.errors?.['required']">
            Valor total obrigatório.
          </ng-container>
          <ng-container *ngIf="item.get('totalPrice')?.errors?.['min']">
            Valor total deve ser maior que zero.
          </ng-container>
        </div>
      </div>

      <!-- Ações -->
      <div class="cell actions">
        <button type="button" (click)="removeItem(i)">Excluir</button>
      </div>
    </div>

    <button type="button" (click)="generateFakeItems()">
      + Gerar 100 Itens
    </button>
  </div>

  <!-- Adicionar item -->
  <div class="add-row">
    <button type="button" (click)="addItem()">+ Adicionar Item</button>
  </div>
</form>
